-- Creator: bro_broa
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BroBroaGUI"
ScreenGui.Parent = game.CoreGui

-- File system check
local writefile = writefile or nil
local readfile = readfile or nil
local isfile = isfile or nil
local makefolder = makefolder or nil
local scriptLibraryPath = "BroBroaGUI/ScriptLibrary.json"

-- Main GUI Colors
local MainColor = Color3.fromRGB(60, 60, 80)
local SecondaryColor = Color3.fromRGB(45, 45, 60)
local AccentColor = Color3.fromRGB(100, 150, 255)
local BorderColor = Color3.fromRGB(120, 160, 220)

-- Main Frame with rounded corners and border
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 550, 0, 450)
MainFrame.Position = UDim2.new(0.5, -275, 0.5, -225)
MainFrame.BackgroundColor3 = MainColor
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local MainBorder = Instance.new("UIStroke")
MainBorder.Thickness = 1.5
MainBorder.Color = BorderColor
MainBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
MainBorder.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = SecondaryColor
TitleBar.BorderSizePixel = 0
TitleBar.Position = UDim2.new(0, 0, 0, 0)

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(0.7, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Bro_broa executor 2.0"
Title.TextColor3 = Color3.fromRGB(220, 220, 220)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -90, 0, 0)
MinimizeButton.Text = "-"
MinimizeButton.BackgroundTransparency = 1
MinimizeButton.TextColor3 = Color3.fromRGB(200, 200, 200)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 20

local LockButton = Instance.new("TextButton")
LockButton.Name = "LockButton"
LockButton.Size = UDim2.new(0, 30, 0, 30)
LockButton.Position = UDim2.new(1, -60, 0, 0)
LockButton.Text = "ðŸ”“"
LockButton.BackgroundTransparency = 1
LockButton.TextColor3 = Color3.fromRGB(150, 200, 255)

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.Text = "X"
CloseButton.BackgroundTransparency = 1
CloseButton.TextColor3 = Color3.fromRGB(255, 100, 100)
CloseButton.Font = Enum.Font.GothamBold

-- Tabs
local Tabs = Instance.new("Frame")
Tabs.Name = "Tabs"
Tabs.Size = UDim2.new(1, 0, 0, 40)
Tabs.Position = UDim2.new(0, 0, 0, 30)
Tabs.BackgroundColor3 = SecondaryColor

local TabsCorner = Instance.new("UICorner")
TabsCorner.CornerRadius = UDim.new(0, 8)
TabsCorner.Parent = Tabs

local ExecutorTab = Instance.new("TextButton")
ExecutorTab.Name = "ExecutorTab"
ExecutorTab.Size = UDim2.new(0.3, 0, 1, 0)
ExecutorTab.BackgroundColor3 = AccentColor
ExecutorTab.Text = "Executor"
ExecutorTab.TextColor3 = Color3.new(1, 1, 1)
ExecutorTab.Font = Enum.Font.Gotham

local LibraryTab = Instance.new("TextButton")
LibraryTab.Name = "LibraryTab"
LibraryTab.Size = UDim2.new(0.3, 0, 1, 0)
LibraryTab.Position = UDim2.new(0.3, 0, 0, 0)
LibraryTab.BackgroundColor3 = SecondaryColor
LibraryTab.Text = "Library"
LibraryTab.TextColor3 = Color3.new(0.8, 0.8, 0.8)
LibraryTab.Font = Enum.Font.Gotham

local SettingsTab = Instance.new("TextButton")
SettingsTab.Name = "SettingsTab"
SettingsTab.Size = UDim2.new(0.3, 0, 1, 0)
SettingsTab.Position = UDim2.new(0.6, 0, 0, 0)
SettingsTab.BackgroundColor3 = SecondaryColor
SettingsTab.Text = "Settings"
SettingsTab.TextColor3 = Color3.new(0.8, 0.8, 0.8)
SettingsTab.Font = Enum.Font.Gotham

local Line = Instance.new("Frame")
Line.Name = "Line"
Line.Size = UDim2.new(1, 0, 0, 2)
Line.Position = UDim2.new(0, 0, 0, 70)
Line.BackgroundColor3 = AccentColor
Line.BorderSizePixel = 0

-- Executor Page
local ExecutorPage = Instance.new("Frame")
ExecutorPage.Name = "ExecutorPage"
ExecutorPage.Size = UDim2.new(1, -20, 1, -80)
ExecutorPage.Position = UDim2.new(0, 10, 0, 75)
ExecutorPage.BackgroundTransparency = 1
ExecutorPage.Visible = true

-- Script Container with Line Numbers
local ScriptContainer = Instance.new("Frame")
ScriptContainer.Name = "ScriptContainer"
ScriptContainer.Size = UDim2.new(1, 0, 0.8, 0)
ScriptContainer.BackgroundTransparency = 1

-- Line Numbers Frame
local LineNumbers = Instance.new("ScrollingFrame")
LineNumbers.Name = "LineNumbers"
LineNumbers.Size = UDim2.new(0, 40, 1, 0)
LineNumbers.BackgroundTransparency = 1
LineNumbers.ScrollBarThickness = 0
LineNumbers.AutomaticCanvasSize = Enum.AutomaticSize.Y
LineNumbers.CanvasSize = UDim2.new(0, 0, 0, 0)
LineNumbers.ScrollingDirection = Enum.ScrollingDirection.Y
LineNumbers.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar
LineNumbers.ScrollingEnabled = false -- Prevent independent scrolling

local LineNumbersLayout = Instance.new("UIListLayout")
LineNumbersLayout.Padding = UDim.new(0, 0)
LineNumbersLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Script Box with Text
local ScriptBox = Instance.new("ScrollingFrame")
ScriptBox.Name = "ScriptBox"
ScriptBox.Size = UDim2.new(1, -40, 1, 0)
ScriptBox.Position = UDim2.new(0, 40, 0, 0)
ScriptBox.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
ScriptBox.ScrollBarThickness = 8
ScriptBox.BorderSizePixel = 0
ScriptBox.AutomaticCanvasSize = Enum.AutomaticSize.Y
ScriptBox.ScrollingDirection = Enum.ScrollingDirection.Y
ScriptBox.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar

local ScriptBoxCorner = Instance.new("UICorner")
ScriptBoxCorner.CornerRadius = UDim.new(0, 6)
ScriptBoxCorner.Parent = ScriptBox

local ScriptBoxBorder = Instance.new("UIStroke")
ScriptBoxBorder.Thickness = 1
ScriptBoxBorder.Color = Color3.fromRGB(80, 80, 100)
ScriptBoxBorder.Parent = ScriptBox

local InputBox = Instance.new("TextBox")
InputBox.Name = "InputBox"
InputBox.Size = UDim2.new(1, -15, 1, -5)
InputBox.Position = UDim2.new(0, 5, 0, 5)
InputBox.BackgroundTransparency = 1
InputBox.Text = ""
InputBox.TextColor3 = Color3.new(0.9, 0.9, 0.9)
InputBox.TextSize = 14
InputBox.TextXAlignment = Enum.TextXAlignment.Left
InputBox.TextYAlignment = Enum.TextYAlignment.Top
InputBox.Font = Enum.Font.RobotoMono
InputBox.MultiLine = true
InputBox.TextWrapped = false
InputBox.ClearTextOnFocus = false

-- Function to sync scrolling
local function syncScroll()
    LineNumbers.CanvasPosition = Vector2.new(0, ScriptBox.CanvasPosition.Y)
end

ScriptBox:GetPropertyChangedSignal("CanvasPosition"):Connect(syncScroll)

-- Function to update line numbers
local function updateLineNumbers()
    local lineCount = #string.split(InputBox.Text, "\n")
    if lineCount == 0 then lineCount = 1 end
    
    -- Clear existing line numbers
    for _, child in ipairs(LineNumbers:GetChildren()) do
        if child:IsA("TextLabel") then
            child:Destroy()
        end
    end
    
    -- Create new line numbers
    for i = 1, lineCount do
        local lineLabel = Instance.new("TextLabel")
        lineLabel.Name = "Line_" .. i
        lineLabel.Size = UDim2.new(1, 0, 0, 20)
        lineLabel.BackgroundTransparency = 1
        lineLabel.Text = tostring(i)
        lineLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
        lineLabel.TextXAlignment = Enum.TextXAlignment.Right
        lineLabel.Font = Enum.Font.RobotoMono
        lineLabel.TextSize = 14
        lineLabel.Parent = LineNumbers
    end
    
    -- Update canvas sizes
    local textHeight = lineCount * 20
    LineNumbers.CanvasSize = UDim2.new(0, 0, 0, textHeight)
    ScriptBox.CanvasSize = UDim2.new(0, 0, 0, textHeight)
end

InputBox:GetPropertyChangedSignal("Text"):Connect(updateLineNumbers)

-- Buttons
local ExecuteButton = Instance.new("TextButton")
ExecuteButton.Name = "ExecuteButton"
ExecuteButton.Size = UDim2.new(0.3, -5, 0, 35)
ExecuteButton.Position = UDim2.new(0, 0, 0.8, 10)
ExecuteButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
ExecuteButton.Text = "Execute"
ExecuteButton.TextColor3 = Color3.new(1, 1, 1)
ExecuteButton.Font = Enum.Font.GothamBold

local ExecuteCorner = Instance.new("UICorner")
ExecuteCorner.CornerRadius = UDim.new(0, 6)
ExecuteCorner.Parent = ExecuteButton

local ClearButton = Instance.new("TextButton")
ClearButton.Name = "ClearButton"
ClearButton.Size = UDim2.new(0.3, -5, 0, 35)
ClearButton.Position = UDim2.new(0.33, 0, 0.8, 10)
ClearButton.BackgroundColor3 = Color3.fromRGB(200, 80, 80)
ClearButton.Text = "Clear"
ClearButton.TextColor3 = Color3.new(1, 1, 1)
ClearButton.Font = Enum.Font.GothamBold
ClearButton.TextSize = 14

local ClearCorner = Instance.new("UICorner")
ClearCorner.CornerRadius = UDim.new(0, 6)
ClearCorner.Parent = ClearButton

local SaveButton = Instance.new("TextButton")
SaveButton.Name = "SaveButton"
SaveButton.Size = UDim2.new(0.3, -5, 0, 35)
SaveButton.Position = UDim2.new(0.66, 0, 0.8, 10)
SaveButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
SaveButton.Text = "Save to Library"
SaveButton.TextColor3 = Color3.new(1, 1, 1)
SaveButton.Font = Enum.Font.GothamBold
SaveButton.TextSize = 14

local SaveCorner = Instance.new("UICorner")
SaveCorner.CornerRadius = UDim.new(0, 6)
SaveCorner.Parent = SaveButton

-- Library Page
local LibraryPage = Instance.new("Frame")
LibraryPage.Name = "LibraryPage"
LibraryPage.Size = UDim2.new(1, -20, 1, -80)
LibraryPage.Position = UDim2.new(0, 10, 0, 75)
LibraryPage.BackgroundTransparency = 1
LibraryPage.Visible = false

local ScriptsFrame = Instance.new("ScrollingFrame")
ScriptsFrame.Name = "ScriptsFrame"
ScriptsFrame.Size = UDim2.new(1, 0, 1, 0)
ScriptsFrame.BackgroundTransparency = 1
ScriptsFrame.ScrollBarThickness = 8
ScriptsFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
ScriptsFrame.ScrollingDirection = Enum.ScrollingDirection.Y

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Template for script entries
local Template = Instance.new("Frame")
Template.Name = "Template"
Template.Size = UDim2.new(1, 0, 0, 50)
Template.BackgroundColor3 = SecondaryColor
Template.Visible = false

local TemplateCorner = Instance.new("UICorner")
TemplateCorner.CornerRadius = UDim.new(0, 8)
TemplateCorner.Parent = Template

local TemplateBorder = Instance.new("UIStroke")
TemplateBorder.Thickness = 1
TemplateBorder.Color = Color3.fromRGB(80, 100, 140)
TemplateBorder.Parent = Template

local ScriptName = Instance.new("TextLabel")
ScriptName.Name = "ScriptName"
ScriptName.Size = UDim2.new(0.5, 0, 1, 0)
ScriptName.BackgroundTransparency = 1
ScriptName.Text = "Script Name"
ScriptName.TextColor3 = Color3.new(0.8, 0.8, 0.8)
ScriptName.TextXAlignment = Enum.TextXAlignment.Left
ScriptName.Position = UDim2.new(0, 15, 0, 0)
ScriptName.Font = Enum.Font.Gotham

local CopyButton = Instance.new("TextButton")
CopyButton.Name = "CopyButton"
CopyButton.Size = UDim2.new(0.15, 0, 0.7, 0)
CopyButton.Position = UDim2.new(0.5, 5, 0.15, 0)
CopyButton.BackgroundColor3 = Color3.fromRGB(120, 120, 200)
CopyButton.Text = "Copy"
CopyButton.TextColor3 = Color3.new(1, 1, 1)
CopyButton.Font = Enum.Font.Gotham
CopyButton.TextSize = 12

local CopyCorner = Instance.new("UICorner")
CopyCorner.CornerRadius = UDim.new(0, 6)
CopyCorner.Parent = CopyButton

local LoadButton = Instance.new("TextButton")
LoadButton.Name = "LoadButton"
LoadButton.Size = UDim2.new(0.15, 0, 0.7, 0)
LoadButton.Position = UDim2.new(0.67, 5, 0.15, 0)
LoadButton.BackgroundColor3 = Color3.fromRGB(70, 150, 220)
LoadButton.Text = "Load"
LoadButton.TextColor3 = Color3.new(1, 1, 1)
LoadButton.Font = Enum.Font.Gotham
LoadButton.TextSize = 12

local LoadCorner = Instance.new("UICorner")
LoadCorner.CornerRadius = UDim.new(0, 6)
LoadCorner.Parent = LoadButton

local DeleteButton = Instance.new("TextButton")
DeleteButton.Name = "DeleteButton"
DeleteButton.Size = UDim2.new(0.15, 0, 0.7, 0)
DeleteButton.Position = UDim2.new(0.84, 5, 0.15, 0)
DeleteButton.BackgroundColor3 = Color3.fromRGB(180, 70, 70)
DeleteButton.Text = "Delete"
DeleteButton.TextColor3 = Color3.new(1, 1, 1)
DeleteButton.Font = Enum.Font.Gotham
DeleteButton.TextSize = 12

local DeleteCorner = Instance.new("UICorner")
DeleteCorner.CornerRadius = UDim.new(0, 6)
DeleteCorner.Parent = DeleteButton

-- Settings Page
local SettingsPage = Instance.new("Frame")
SettingsPage.Name = "SettingsPage"
SettingsPage.Size = UDim2.new(1, -20, 1, -80)
SettingsPage.Position = UDim2.new(0, 10, 0, 75)
SettingsPage.BackgroundTransparency = 1
SettingsPage.Visible = false

local ColorLabel = Instance.new("TextLabel")
ColorLabel.Name = "ColorLabel"
ColorLabel.Size = UDim2.new(1, 0, 0, 30)
ColorLabel.Position = UDim2.new(0, 0, 0, 20)
ColorLabel.BackgroundTransparency = 1
ColorLabel.Text = "Script Box Background Color (0-255):"
ColorLabel.TextColor3 = Color3.new(0.8, 0.8, 0.8)
ColorLabel.TextXAlignment = Enum.TextXAlignment.Left
ColorLabel.Font = Enum.Font.Gotham

-- FIXED: Adjust RGB input positions with proper spacing
local RBox = Instance.new("TextBox")
RBox.Name = "RBox"
RBox.Size = UDim2.new(0.18, 0, 0, 35)
RBox.Position = UDim2.new(0, 5, 0, 60)
RBox.BackgroundColor3 = SecondaryColor
RBox.PlaceholderText = "R"
RBox.Text = "35"
RBox.TextColor3 = Color3.new(1, 1, 1)
RBox.Font = Enum.Font.Gotham

local RBoxCorner = Instance.new("UICorner")
RBoxCorner.CornerRadius = UDim.new(0, 6)
RBoxCorner.Parent = RBox

local GBox = Instance.new("TextBox")
GBox.Name = "GBox"
GBox.Size = UDim2.new(0.18, 0, 0, 35)
GBox.Position = UDim2.new(0.2, 10, 0, 60)
GBox.BackgroundColor3 = SecondaryColor
GBox.PlaceholderText = "G"
GBox.Text = "35"
GBox.TextColor3 = Color3.new(1, 1, 1)
GBox.Font = Enum.Font.Gotham

local GBoxCorner = Instance.new("UICorner")
GBoxCorner.CornerRadius = UDim.new(0, 6)
GBoxCorner.Parent = GBox

local BBox = Instance.new("TextBox")
BBox.Name = "BBox"
BBox.Size = UDim2.new(0.18, 0, 0, 35)
BBox.Position = UDim2.new(0.4, 15, 0, 60)
BBox.BackgroundColor3 = SecondaryColor
BBox.PlaceholderText = "B"
BBox.Text = "45"
BBox.TextColor3 = Color3.new(1, 1, 1)
BBox.Font = Enum.Font.Gotham

local BBoxCorner = Instance.new("UICorner")
BBoxCorner.CornerRadius = UDim.new(0, 6)
BBoxCorner.Parent = BBox

-- FIXED: Apply button positioning with margin
local ApplyButton = Instance.new("TextButton")
ApplyButton.Name = "ApplyButton"
ApplyButton.Size = UDim2.new(0.25, 0, 0, 35)
ApplyButton.Position = UDim2.new(0.65, 10, 0, 60)
ApplyButton.BackgroundColor3 = AccentColor
ApplyButton.Text = "Apply Color"
ApplyButton.TextColor3 = Color3.new(1, 1, 1)
ApplyButton.Font = Enum.Font.GothamBold
ApplyButton.TextSize = 13

local ApplyCorner = Instance.new("UICorner")
ApplyCorner.CornerRadius = UDim.new(0, 6)
ApplyCorner.Parent = ApplyButton

-- Minimized Mode - Circular GUI (movable)
local MinimizedFrame = Instance.new("ImageButton")
MinimizedFrame.Name = "MinimizedFrame"
MinimizedFrame.Size = UDim2.new(0, 50, 0, 50)
MinimizedFrame.Position = UDim2.new(0, 100, 0, 100)
MinimizedFrame.Image = "http://www.roblox.com/asset/?id=119526989765479"
MinimizedFrame.Visible = false
MinimizedFrame.Active = true
MinimizedFrame.Draggable = true  -- Always movable

local MinimizedCorner = Instance.new("UICorner")
MinimizedCorner.CornerRadius = UDim.new(1, 0)
MinimizedCorner.Parent = MinimizedFrame

local MinimizedBorder = Instance.new("UIStroke")
MinimizedBorder.Thickness = 1.5
MinimizedBorder.Color = BorderColor
MinimizedBorder.Parent = MinimizedFrame

-- Parent Hierarchy
MinimizedFrame.Parent = ScreenGui
Template.Parent = ScreenGui
ScriptName.Parent = Template
CopyButton.Parent = Template
LoadButton.Parent = Template
DeleteButton.Parent = Template
LineNumbersLayout.Parent = LineNumbers
LineNumbers.Parent = ScriptContainer
InputBox.Parent = ScriptBox
ScriptBox.Parent = ScriptContainer
ScriptContainer.Parent = ExecutorPage
ExecutorPage.Parent = MainFrame
LibraryPage.Parent = MainFrame
SettingsPage.Parent = MainFrame
ColorLabel.Parent = SettingsPage
RBox.Parent = SettingsPage
GBox.Parent = SettingsPage
BBox.Parent = SettingsPage
ApplyButton.Parent = SettingsPage
ExecuteButton.Parent = ExecutorPage
ClearButton.Parent = ExecutorPage
SaveButton.Parent = ExecutorPage
ScriptsFrame.Parent = LibraryPage
UIListLayout.Parent = ScriptsFrame
Line.Parent = MainFrame
ExecutorTab.Parent = Tabs
LibraryTab.Parent = Tabs
SettingsTab.Parent = Tabs
Tabs.Parent = MainFrame
MinimizeButton.Parent = TitleBar
CloseButton.Parent = TitleBar
LockButton.Parent = TitleBar
Title.Parent = TitleBar
TitleBar.Parent = MainFrame
MainFrame.Parent = ScreenGui

-- Script Library
local ScriptLibrary = {
    ["Bro_broa GUI 5.0"] = '-- Creator by bro_broa3\nloadstring(game:HttpGet("https://raw.githubusercontent.com/Bro-broa3/Bro_broa-scripts/refs/heads/main/Bro_broa%20gui%205.0"))()',
    ["Infinite Yield"] = 'loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()'
}

-- JSON File Handling Functions
local function SaveLibrary()
    if writefile and makefolder and readfile and isfile then
        pcall(function()
            if not isfile("BroBroaGUI") then
                makefolder("BroBroaGUI")
            end
            local json = game:GetService("HttpService"):JSONEncode(ScriptLibrary)
            writefile(scriptLibraryPath, json)
            print("Script library saved successfully!")
        end)
    else
        warn("File operations not supported - using in-memory storage only")
    end
end

local function LoadLibrary()
    if readfile and isfile and isfile(scriptLibraryPath) then
        pcall(function()
            local data = readfile(scriptLibraryPath)
            ScriptLibrary = game:GetService("HttpService"):JSONDecode(data)
            print("Script library loaded successfully!")
        end)
    else
        print("No saved script library found - using default scripts")
    end
end

-- Functions
local function CreateScriptEntry(name, content)
    local newEntry = Template:Clone()
    newEntry.Name = name
    newEntry.ScriptName.Text = name
    newEntry.Visible = true
    newEntry.LayoutOrder = #ScriptsFrame:GetChildren()
    newEntry.Parent = ScriptsFrame
    
    newEntry.LoadButton.MouseButton1Click:Connect(function()
        InputBox.Text = content
        ExecutorPage.Visible = true
        LibraryPage.Visible = false
        SettingsPage.Visible = false
        ExecutorTab.BackgroundColor3 = AccentColor
        LibraryTab.BackgroundColor3 = SecondaryColor
        SettingsTab.BackgroundColor3 = SecondaryColor
        updateLineNumbers()
    end)
    
    newEntry.CopyButton.MouseButton1Click:Connect(function()
        setclipboard(content)
        newEntry.CopyButton.Text = "Copied!"
        task.wait(1)
        newEntry.CopyButton.Text = "Copy"
    end)
    
    newEntry.DeleteButton.MouseButton1Click:Connect(function()
        ScriptLibrary[name] = nil
        newEntry:Destroy()
        SaveLibrary()  -- Save after deletion
    end)
end

local function UpdateLibrary()
    for i, child in ipairs(ScriptsFrame:GetChildren()) do
        if child:IsA("Frame") and child ~= Template then
            child:Destroy()
        end
    end
    
    for name, content in pairs(ScriptLibrary) do
        CreateScriptEntry(name, content)
    end
end

-- Initialization
LoadLibrary()  -- Load saved scripts
UpdateLibrary()
updateLineNumbers()

-- Tab Switching
ExecutorTab.MouseButton1Click:Connect(function()
    ExecutorPage.Visible = true
    LibraryPage.Visible = false
    SettingsPage.Visible = false
    ExecutorTab.BackgroundColor3 = AccentColor
    LibraryTab.BackgroundColor3 = SecondaryColor
    SettingsTab.BackgroundColor3 = SecondaryColor
end)

LibraryTab.MouseButton1Click:Connect(function()
    ExecutorPage.Visible = false
    LibraryPage.Visible = true
    SettingsPage.Visible = false
    LibraryTab.BackgroundColor3 = AccentColor
    ExecutorTab.BackgroundColor3 = SecondaryColor
    SettingsTab.BackgroundColor3 = SecondaryColor
end)

SettingsTab.MouseButton1Click:Connect(function()
    ExecutorPage.Visible = false
    LibraryPage.Visible = false
    SettingsPage.Visible = true
    SettingsTab.BackgroundColor3 = AccentColor
    ExecutorTab.BackgroundColor3 = SecondaryColor
    LibraryTab.BackgroundColor3 = SecondaryColor
end)

-- Button Functionality
ExecuteButton.MouseButton1Click:Connect(function()
    local success, err = pcall(function()
        loadstring(InputBox.Text)()
    end)
    
    if not success then
        warn("Execution error: " .. err)
    end
end)

ClearButton.MouseButton1Click:Connect(function()
    InputBox.Text = ""
    updateLineNumbers()
end)

SaveButton.MouseButton1Click:Connect(function()
    local name = "Script_" .. tostring(math.random(1000,9999))
    ScriptLibrary[name] = InputBox.Text
    UpdateLibrary()
    SaveLibrary()  -- Save after adding new script
end)

ApplyButton.MouseButton1Click:Connect(function()
    local r = math.clamp(tonumber(RBox.Text) or 35, 0, 255)
    local g = math.clamp(tonumber(GBox.Text) or 35, 0, 255)
    local b = math.clamp(tonumber(BBox.Text) or 45, 0, 255)
    
    RBox.Text = tostring(r)
    GBox.Text = tostring(g)
    BBox.Text = tostring(b)
    
    ScriptBox.BackgroundColor3 = Color3.fromRGB(r, g, b)
end)

MinimizeButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MinimizedFrame.Visible = true
end)

MinimizedFrame.MouseButton1Click:Connect(function()
    MinimizedFrame.Visible = false
    MainFrame.Visible = true
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

LockButton.MouseButton1Click:Connect(function()
    MainFrame.Draggable = not MainFrame.Draggable
    LockButton.Text = MainFrame.Draggable and "ðŸ”“" or "ðŸ”’"
end)
